<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>✍️ Quick Journal</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="journal-container">
    
    <!-- Step 1: Select Enemy Tags -->
    <div class="step-section">
      <div class="step-header">
        <span class="step-number">1</span>
        <h3>What are you reflecting on?</h3>
      </div>
      <ion-grid fixed class="ion-no-padding">
        <ion-row>
          @for (enemy of sixEnemies; track $index) {
            <ion-col size="2" style="text-align: center;">
              <ion-button (click)="selectEnemy($index)" size="small" shape="round" [fill]="enemy.selected ? 'solid' : 'outline'">
                <ion-avatar slot="icon-only" color="primary" class="avatar">
                  <app-meditation-icon [active]="enemy.selected" [icon]="enemy.key"></app-meditation-icon>
                </ion-avatar>
              </ion-button>
              <div class="enemy-label">{{enemy.name}}</div>
            </ion-col>
          }
        </ion-row>
      </ion-grid>
    </div>

    <!-- Smart Prompts -->
    @if (showPrompts && currentPrompts.length > 0) {
      <div class="prompts-section">
        <div class="prompts-header">
          <ion-icon name="bulb-outline"></ion-icon>
          <span>Reflection Prompts</span>
        </div>
        <div class="prompts-list">
          @for (prompt of currentPrompts; track $index) {
            <button class="prompt-chip" (click)="usePrompt(prompt)">
              {{prompt}}
            </button>
          }
        </div>
      </div>
    }

    <!-- Step 2: Write Your Reflection -->
    <div class="step-section">
      <div class="step-header">
        <span class="step-number">2</span>
        <h3>Write your reflection</h3>
      </div>
      <ion-textarea
        [(ngModel)]="dailyJournal"
        placeholder="What happened? How did you feel? What did you learn?&#10;&#10;Tap the prompts above to get started..."
        [autoGrow]="true"
        rows="6"
        [counter]="true"
        maxlength="1000"
        class="journal-textarea">
      </ion-textarea>
      <div class="character-hint">
        @if (dailyJournal && dailyJournal.length < 20) {
          <ion-text color="medium">
            <small>{{20 - dailyJournal.length}} more characters needed</small>
          </ion-text>
        } @else if (dailyJournal && dailyJournal.length >= 20) {
          <ion-text color="success">
            <small>✓ Ready to save</small>
          </ion-text>
        }
      </div>
    </div>

    <!-- Step 3: How do you feel now? (Optional) -->
    @if (dailyJournal && dailyJournal.length >= 20) {
      <div class="step-section">
        <div class="step-header">
          <span class="step-number">3</span>
          <h3>How do you feel after writing?</h3>
        </div>
        <div class="mood-selector">
          @for (mood of moods; track mood.value) {
            <button 
              class="mood-button"
              [class.selected]="moodAfter === mood.value"
              (click)="selectMood('after', mood.value)">
              <span class="mood-emoji">{{mood.emoji}}</span>
              <span class="mood-label">{{mood.label}}</span>
            </button>
          }
        </div>
      </div>
    }

    <!-- Action Buttons -->
    <div class="action-section">
      <div class="action-buttons">
        <ion-button
          expand="block"
          fill="outline"
          (click)="cancel()"
          class="cancel-button">
          <ion-icon name="close-outline" slot="start"></ion-icon>
          Close
        </ion-button>
        
        <ion-button
          expand="block"
          [disabled]="!canSave"
          (click)="saveDailyJournal()"
          class="save-button">
          @if (saving) {
            <ion-spinner name="crescent"></ion-spinner>
          } @else {
            <ion-icon name="checkmark-outline" slot="start"></ion-icon>
            Save
          }
        </ion-button>
      </div>
    </div>

    <!-- Bottom Spacing -->
    <div style="height: 40px;"></div>
  </div>
</ion-content>